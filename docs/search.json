[
  {
    "objectID": "explor1_rouen.html",
    "href": "explor1_rouen.html",
    "title": "Exploration 1 : La précarité énergétique des quartiers de Rouen",
    "section": "",
    "text": "Code\nlibrary(knitr)\nlibrary(dplyr)\nlibrary(questionr)\n\nlibrary(sf)\nlibrary(mapsf)\nlibrary(ggplot2)\nDans cette première exploration on va commencer en prendre en main les données en se donnant comme objectif d’étudier les variations de précarité énergétique entre les quartiers de la commune de Rouen. On se limitera à l’utilisation d’outils statistiques - apparemment - simples de statistique bivariée que l’on complexifiera progressivement."
  },
  {
    "objectID": "explor1_rouen.html#données",
    "href": "explor1_rouen.html#données",
    "title": "Exploration 1 : La précarité énergétique des quartiers de Rouen",
    "section": "1. Données",
    "text": "1. Données\n\nDonnées géométriques\nOn extrait du fond de carte des 42 IRIS la commune de Rouen et on crée un fonds de carte regroupant ceux-ci en 10 quartiers.\n\n\nCode\nmap_iris &lt;- readRDS(\"data/mapiris.RDS\") %&gt;% filter(substr(iris_code,1,5)==\"76540\")\nmap_quart &lt;- map_iris %&gt;% group_by(quart_code, quart_name) %&gt;%\n                         summarise() \nmap_com &lt;- map_iris %&gt;% summarise()\n\n\nmf_map(map_iris, type=\"typo\",var=\"quart_code\", border=\"white\",lwd=0.5, leg_title = \"Quartiers\")\nmf_map(map_quart, type = \"base\", col=NA, add=T, border=\"black\",lwd=1)\nmf_layout(\"Iris et quartiers de Rouen\", frame = T, credits = \"Source : IGN\")\n\n\n\n\n\n\n\n\n\n\n\nDonnées statistiques\nOn extrait du fichier DPE les diagnistics relatifs à la commune de Rouen et on sélectionne un nombre volontairement limité d’indicateurs.\n\n\nCode\nmap_dpe&lt;-readRDS(\"data/dpe.RDS\") %&gt;%\n           filter(com_code == \"76540\",\n                  substr(quart_code,1,5) == \"76540\") %&gt;%\n           select(quart_code, \n                  quart_name,\n                  dpe,\n                  sup,\n                  con_tot,\n                  con_m2,\n                  dat,\n                  typ) %&gt;% \n          mutate(quart_code = as.character(quart_code),\n                 quart_name = as.character(quart_name))\ndon&lt;-st_drop_geometry(map_dpe) %&gt;% filter(is.na(dpe)==F,\n                                          is.na(con_m2)==F)\n\nkable(head(don), caption= \"Extrait du fichier DPE\")\n\n\n\nExtrait du fichier DPE\n\n\n\n\n\n\n\n\n\n\n\n\nquart_code\nquart_name\ndpe\nsup\ncon_tot\ncon_m2\ndat\ntyp\n\n\n\n\n7654001\nCentre Rive Droite Ouest\nD\n56.7\n13449.7\n237.2\n1900\nappartement\n\n\n7654006\nQuartiers Est\nF\n90.6\n29722.1\n328.0\n1948\nappartement\n\n\n7654001\nCentre Rive Droite Ouest\nD\n70.0\n12936.9\n192.0\n1949\nmaison\n\n\n7654003\nCentre Rive Gauche\nG\n19.7\n15175.8\n769.1\n1949\nappartement\n\n\n7654001\nCentre Rive Droite Ouest\nD\n62.1\n15101.9\n243.0\n1947\nappartement\n\n\n7654002\nCentre Rive Droite Est\nE\n35.7\n4503.5\n289.0\n1948\nappartement\n\n\n\n\n\n\n\nSuperposition\nOn superpose les deux sources de données en utilisant les localisations du fichier dpe :\n\n\nCode\nmf_map(map_quart, type = \"base\", col=\"lightyellow\", border=\"black\",lwd=1)\nmf_map(map_dpe, type=\"base\", col=\"red\",pch=20, cex=0.1, add=T)\nmf_layout(\"Localisation des DEP par quartiers de Rouen\", frame = T, credits = \"Source : IGN\")"
  },
  {
    "objectID": "explor1_rouen.html#quelle-mesure-de-précarité",
    "href": "explor1_rouen.html#quelle-mesure-de-précarité",
    "title": "Exploration 1 : La précarité énergétique des quartiers de Rouen",
    "section": "2. Quelle mesure de précarité ?",
    "text": "2. Quelle mesure de précarité ?\nQuelle est la variable que nous souhaitons analyser ? Les passoires énergétiques sont en principe définies par l’appartenance aux catégories énergétiques F et G.\n\nEtiquette énergétique en 7 classes\nQuelle est la distribution générale des étiquettes énergétiques ? Réalisons un tableau et un graphique.\n\n\nCode\n#Tableau\ntab &lt;- freq(don$dpe,cum = T,valid = F)\nkable(tab, caption = \"Etiquettes énergétiques des logements\")\n\n\n\nEtiquettes énergétiques des logements\n\n\n\nn\n%\n%cum\n\n\n\n\nA\n144\n0.3\n0.3\n\n\nB\n1194\n2.2\n2.5\n\n\nC\n15512\n29.1\n31.6\n\n\nD\n17211\n32.3\n64.0\n\n\nE\n11988\n22.5\n86.5\n\n\nF\n4209\n7.9\n94.4\n\n\nG\n2987\n5.6\n100.0\n\n\n\n\n\nCode\n# Graphique\nmypal7&lt;-c(\"green4\",\"green3\",\"lightgreen\",\"yellow\",\"goldenrod1\",\"darkorange\",\"red\")\nplot(don$dpe, col=mypal7, \n        main = \"Etiquettes énergétiques des logements\",\n        sub =  \"Source : Base DPE, Commune de Rouen\",\n        ylab = \"Nombre de logements\")\n\n\n\n\n\n\n\n\n\n\nLes catégories les plus fréquentes sont les catégories intermédiaires (C, D et E) qui représentent environ trois-quarts du parc de logement étudié. Les logements à faible consommation (A ou B) ne représentent que 2.5% du total. Les logements à forte consommation (F ou G) totalisent 13.5% du total\n\n\n\nEtiquette et consommation d’énergie primaire par m2\nMême si la correspondance n’est pas parfaite, il existe un lien étroit entre la consommation d’énergie primaire par m2 de logement habitable (en log) et l’étiquette DPE attribuée par l’ADEME.\n\n\nCode\n# Graphique R-Base\nmypal7&lt;-c(\"green4\",\"green3\",\"lightgreen\",\"yellow\",\"goldenrod1\",\"darkorange\",\"red\")\nboxplot(don$con_m2~don$dpe, \n        col=mypal7, \n        cex=0.2, \n        log =\"y\",\n        xlab=\"Consommation d'énergie primaire par m2\",\n        ylab = \"Etiquette DPE\",\n        main=\"Relation entre étiquettes et consommation d'énergie\",\n        sub = \"Source : Base DPE, Commune de Rouen\")\ngrid(lwd=1)\n\n\n\n\n\n\n\n\n\n\n\nCode\n#Graphique ggplot2\nmypal7&lt;-c(\"green4\",\"green3\",\"lightgreen\",\"yellow\",\"goldenrod1\",\"darkorange\",\"red\")\nggplot(don) + aes(x=dpe,y=con_m2)+\n              geom_violin(aes(fill=dpe)) + \n              scale_y_log10(\"Consommation d'énergie primaire par m2\") + \n              scale_x_discrete(\"Etiquette DPE\")+\n              scale_fill_manual(values=mypal7) + \n              theme_light() +\n              ggtitle(label = \"Relation entre étiquettes et consommation d'énergie\",\n                      subtitle = \"Source : Base DPE, Commune de Rouen\"\n                        )\n\n\nCeci suggère que l’analyse pourrait dans certains cas porter sur cette variable quantitative continue plutôt que sur la variable qualitative ordinale qu’est l’étiquette. Mais en utilisant de préférence une échelle logarithmique.\n\n\nCode\nggplot(don, aes(x=con_m2)) +\n      geom_histogram()+ \n      scale_x_log10(\"Consommation d'énergie primaire par m2 (log)\") + \n      scale_y_continuous(\"Nombre de logements\") +\n      theme_light() +\n      ggtitle(label = \"Consommation d'énergie primaire par m2\",\n                      subtitle = \"Source : Base DPE, Commune de Rouen\"\n                        )\n\n\n\n\n\n\n\n\n\n\n\nSeuil énergétique des passoires\nOn peut assez facilement déduire empiriquement le seuil d’apparition des passoires énergétiques à l’aide d’un modèle Logit :\n\n\nCode\ndon$dpe2 &lt;- don$dpe %in% c(\"F\",\"G\")\nmod1 &lt;- glm(formula = dpe2~con_m2, family = \"binomial\", data=don)\nsummary(mod1)\n\n\n\nCall:\nglm(formula = dpe2 ~ con_m2, family = \"binomial\", data = don)\n\nCoefficients:\n              Estimate Std. Error z value Pr(&gt;|z|)    \n(Intercept) -1.745e+01  2.346e-01  -74.39   &lt;2e-16 ***\ncon_m2       4.891e-02  6.818e-04   71.74   &lt;2e-16 ***\n---\nSignif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n\n(Dispersion parameter for binomial family taken to be 1)\n\n    Null deviance: 42176.3  on 53244  degrees of freedom\nResidual deviance:  9537.9  on 53243  degrees of freedom\nAIC: 9541.9\n\nNumber of Fisher Scoring iterations: 9\n\n\nCode\nplot(mod1$data$con_m2, \n     mod1$fitted.values, \n     cex=0.1, \n     pch=20, \n     col=\"red\", \n     log=\"x\",\n     main = \"Résultat du modèle Logit\",\n     xlab = \"Consommation d'énergie primaire par m2\",\n     ylab = \"Probabilité d'être une passoire énergétique\",\n     subtitle = \"Source : Base DPE, Commune de Rouen\")\npoints(357, 0.5, pch=20, cex=2)\ntext(100, 0.55, \"Probabilité = 0.5\", col=\"blue\")\ntext(357, 0.01, \"357 Kwh/m2/an\", col=\"blue\")\nabline(h=0.5, lty=2, col = \"blue\")\nabline(v=357, lty=2, col= \"blue\")\n\n\n\n\n\n\n\n\n\nLa valeur seuil obtenue est de 357 Kwh/m2, ce qui est légèrement supérieur à la valeur de référence donnée par l’ADEME qui est de 330 Kwh/m2/an pour le passage de la catégorie E à la catégorie F. On peut vérifier que l’approximation est nénamoins très proche de la réalité en comparant les passoires énergétiques déclarées par l’ADEME et l’estimation faite à partir du seuil observé grâce au modèle Logit :\n\n\nCode\nobs &lt;-don$dpe2\nest &lt;-don$con_m2 &gt; 357\nconf&lt;-table(obs,est)\ntabres &lt;- addmargins(conf)\ntabres\n\n\n       est\nobs     FALSE  TRUE   Sum\n  FALSE 45441   608 46049\n  TRUE   1087  6109  7196\n  Sum   46528  6717 53245"
  },
  {
    "objectID": "explor1_rouen.html#précarité-par-quartier",
    "href": "explor1_rouen.html#précarité-par-quartier",
    "title": "Exploration 1 : La précarité énergétique des quartiers de Rouen",
    "section": "3. Précarité par quartier",
    "text": "3. Précarité par quartier\n\nPourcentage de passoires\nSi on part de la variable booléenne, on obtient facilement un pourcentage de passoires énergétiques par quartier :\n\n\nCode\ntab1 &lt;- don %&gt;% group_by(quart_code, quart_name) %&gt;% \n                summarise(tot = n(),\n                          pas = sum(dpe2)) %&gt;%\n                mutate(pct = 100*pas/tot) %&gt;%\n                arrange(pct)\nkable(tab1,\n      digits = c(0,0,0,0,2),\n      col.names = c(\"Code\",\"Nom\",\"Total\", \"N\", \"%\"),\n      caption = \"Nombre et proportion de passoires énergétiques par quartier\")\n\n\n\nNombre et proportion de passoires énergétiques par quartier\n\n\nCode\nNom\nTotal\nN\n%\n\n\n\n\n7654008\nChatelet Lombardie\n2079\n0\n0.00\n\n\n7654009\nGrand Mare\n2622\n40\n1.53\n\n\n7654007\nSapins\n2439\n175\n7.18\n\n\n7654010\nSaint-Clément-Jardin des Plantes\n6676\n506\n7.58\n\n\n7654003\nCentre Rive Gauche\n7352\n571\n7.77\n\n\n7654006\nQuartiers Est\n3184\n399\n12.53\n\n\n7654002\nCentre Rive Droite Est\n8133\n1020\n12.54\n\n\n7654004\nQuartiers Ouest\n7145\n1020\n14.28\n\n\n7654001\nCentre Rive Droite Ouest\n9664\n2350\n24.32\n\n\n7654005\nCoteaux Nord\n3951\n1115\n28.22\n\n\n\n\n\nOn peut cartogaphier le résultat pour visualiser la distribution dans la commune :\n\n\nCode\nmap2 &lt;- map_quart %&gt;% left_join(tab1)\n\nmf_map(map2, type=\"choro\",var=\"pct\", \n       breaks=c(0,5,10,20,100),\n       leg_title = \"% passoires\",\n       leg_val_rnd = 0,\n       leg_pos = \"topleft\")\nmf_map(map2, type=\"prop\", var=\"pas\", \n       leg_title = \"nb. passoires\", \n       leg_pos = \"topright\",\n       inches=0.2,\n       col=\"red\")\nmf_layout(\"Distribtion des passoires énergétiques par quartiers à Rouen\", \n          arrow = F,\n          frame = T, \n          credits = \"Source : IGN & ADEME\")\n\n\n\n\n\n\n\n\n\n\n\nConsommation moyenne d’énergie primaire par m2\nSupposons maintenant que l’on veuille calculer pour chaque quartier la valeur moyenne de conosmmation d’énergie par m2.\n\n\nCode\ntab1 &lt;- don %&gt;% group_by(quart_code, quart_name) %&gt;% \n                filter(is.na(con_tot)==F,\n                       is.na(sup) ==F) %&gt;%\n                summarise(con_tot = sum(con_tot),\n                          sup = sum(sup)) %&gt;%\n                mutate(con_m2 = con_tot/sup) %&gt;%\n                arrange(con_m2)\nkable(tab1,\n      digits = c(0,0,0,0,2),\n      col.names = c(\"Code\",\"Nom\",\"Consommation totale\", \"Surface\", \"Consommation / m2\"),\n      caption = \"Consommation moyenne d'énergie primaire par m2 selon les quartiers\")\n\n\n\nConsommation moyenne d’énergie primaire par m2 selon les quartiers\n\n\n\n\n\n\n\n\n\nCode\nNom\nConsommation totale\nSurface\nConsommation / m2\n\n\n\n\n7654008\nChatelet Lombardie\n20502860\n133059\n154.09\n\n\n7654010\nSaint-Clément-Jardin des Plantes\n73275344\n407292\n179.91\n\n\n7654009\nGrand Mare\n34340742\n188199\n182.47\n\n\n7654003\nCentre Rive Gauche\n75064211\n393148\n190.93\n\n\n7654006\nQuartiers Est\n36867568\n171576\n214.88\n\n\n7654004\nQuartiers Ouest\n76970066\n347701\n221.37\n\n\n7654002\nCentre Rive Droite Est\n83604011\n373750\n223.69\n\n\n7654007\nSapins\n29975978\n133836\n223.98\n\n\n7654005\nCoteaux Nord\n60592161\n221901\n273.06\n\n\n7654001\nCentre Rive Droite Ouest\n122574781\n444471\n275.78\n\n\n\n\n\nOn peut cartogaphier le résultat pour visualiser la distribution dans la commune :\n\n\nCode\nmap2 &lt;- map_quart %&gt;% left_join(tab1)\n\nmf_map(map2, type=\"choro\",var=\"con_m2\", \n      breaks=c(150,180,220,240,280),\n       leg_title = \"Kwh/m2/an\",\n       leg_val_rnd = 0,\n       leg_pos = \"topleft\")\nmf_map(map2, type=\"prop\", var=\"con_tot\", \n       leg_title = \"Kwh\", \n       leg_pos = \"topright\",\n       inches=0.2,\n       col=\"red\")\nmf_layout(\"Consommation d'énergie primaire par quartier à Rouen\", \n          arrow = F,\n          frame = T, \n          credits = \"Source : IGN & ADEME\")"
  },
  {
    "objectID": "index.html",
    "href": "index.html",
    "title": "Approches quantitatives pour l’action publique",
    "section": "",
    "text": "Les données sont essentielles pour l’action publique. Elles permettent l’observation des territoires à différentes échelles, sont nécessaires pour la planification dans de nombreux domaines tels que l’aménagement du territoire, la politique de la ville, la transition écologique ou encore les déplacements. Elles permettent également le pilotage des politiques publiques ainsi que leur évaluation (Ministère de la Transformation et de la Fonction publiques, 2023).\nCes dernières années ont vu une multiplication des bases de données sur des territoires de plus en plus étendus et à des échelles de plus en plus fines en raison de l’évolution des possibilités de stockage et de calcul, mais aussi d’un nombre croissant de réglementations. La France est un des pays les plus avancés en matière d’ouverture des données publiques. Avec la loi pour une République numérique de 2016, elle a posé le principe de l’ouverture des données par défaut (sauf exceptions légales) et introduit une obligation d’open data pour toutes les collectivités de plus de 3500 habitants. Cette mise à disposition s’inscrit dans une volonté de transparence de l’action publique, de modernisation et d’amélioration de l’action publique et enfin de développement économique lié à la réutilisation des données publiques. Cependant, si la loi impose la mise à disposition des données publiques, elle n’impose pas aux producteurs dont ce n’est pas la mission principale tels que l’INSEE, une vérification systématique de leur qualité et de leur représentativité à différentes échelles. Ces données nécessitent donc une analyse critique sur leur exploitation et leur comparabilité.\nComment les bureaux d’études, les chercheurs peuvent-ils se saisir et analyser ces données ? Voici les compétences que ce cours propose aux étudiants d’acquérir à travers i) une initiation théorique aux méthodes de l’analyse statistique en géographie (séances de cours) ii) une mise en œuvre pratique à travers l’utilisation de deux bases de données : l’une produite par l’Ademe sur les caractéristiques énergétiques des logements, l’autre par l’INSEE sur les caractéristiques de l’habitat.\nIl s’agit dans ce volet pratique de se mettre en situation de réponse à une commande (fictive cette année) émanant d’une collectivité (Rouen) ou d’un organisme (Ademe) en charge de la diffusion de données publiques. L’objectif est de manipuler deux bases de données massives de deux origines pour permettre une compréhension territorialisée des inégalités du bâti résidentiel dans la transition énergétique. Les participant.e.s mettront en place un protocole allant de la collecte de données hétérogènes via des API, à leur exploitation à l’aide de méthodes adaptées. Ce protocole intègrera une réflexion sur la sélection des informations pertinentes en tenant compte de leur représentativité et des biais éventuels et leur extraction sur le territoire étudié."
  },
  {
    "objectID": "index.html#objectifs-généraux",
    "href": "index.html#objectifs-généraux",
    "title": "Approches quantitatives pour l’action publique",
    "section": "",
    "text": "Les données sont essentielles pour l’action publique. Elles permettent l’observation des territoires à différentes échelles, sont nécessaires pour la planification dans de nombreux domaines tels que l’aménagement du territoire, la politique de la ville, la transition écologique ou encore les déplacements. Elles permettent également le pilotage des politiques publiques ainsi que leur évaluation (Ministère de la Transformation et de la Fonction publiques, 2023).\nCes dernières années ont vu une multiplication des bases de données sur des territoires de plus en plus étendus et à des échelles de plus en plus fines en raison de l’évolution des possibilités de stockage et de calcul, mais aussi d’un nombre croissant de réglementations. La France est un des pays les plus avancés en matière d’ouverture des données publiques. Avec la loi pour une République numérique de 2016, elle a posé le principe de l’ouverture des données par défaut (sauf exceptions légales) et introduit une obligation d’open data pour toutes les collectivités de plus de 3500 habitants. Cette mise à disposition s’inscrit dans une volonté de transparence de l’action publique, de modernisation et d’amélioration de l’action publique et enfin de développement économique lié à la réutilisation des données publiques. Cependant, si la loi impose la mise à disposition des données publiques, elle n’impose pas aux producteurs dont ce n’est pas la mission principale tels que l’INSEE, une vérification systématique de leur qualité et de leur représentativité à différentes échelles. Ces données nécessitent donc une analyse critique sur leur exploitation et leur comparabilité.\nComment les bureaux d’études, les chercheurs peuvent-ils se saisir et analyser ces données ? Voici les compétences que ce cours propose aux étudiants d’acquérir à travers i) une initiation théorique aux méthodes de l’analyse statistique en géographie (séances de cours) ii) une mise en œuvre pratique à travers l’utilisation de deux bases de données : l’une produite par l’Ademe sur les caractéristiques énergétiques des logements, l’autre par l’INSEE sur les caractéristiques de l’habitat.\nIl s’agit dans ce volet pratique de se mettre en situation de réponse à une commande (fictive cette année) émanant d’une collectivité (Rouen) ou d’un organisme (Ademe) en charge de la diffusion de données publiques. L’objectif est de manipuler deux bases de données massives de deux origines pour permettre une compréhension territorialisée des inégalités du bâti résidentiel dans la transition énergétique. Les participant.e.s mettront en place un protocole allant de la collecte de données hétérogènes via des API, à leur exploitation à l’aide de méthodes adaptées. Ce protocole intègrera une réflexion sur la sélection des informations pertinentes en tenant compte de leur représentativité et des biais éventuels et leur extraction sur le territoire étudié."
  },
  {
    "objectID": "index.html#evaluation-2025-26",
    "href": "index.html#evaluation-2025-26",
    "title": "Approches quantitatives pour l’action publique",
    "section": "Evaluation 2025-26",
    "text": "Evaluation 2025-26\nEn 2025-2026, les étudiant.e.s seront amené.e.s à exploiter la base de données sur les diagnostics de performance énergétique des bâtiments résidentiels gérée par l’ADEME ainsi que des données de l’INSEE sur les logements et les caractéristiques sociales des populations les occupant.\nLe dossier portera sur la ville de ROUEN (Haute-normandie). Le choix du périmètre, du maillage (commune, quartier-IRIS, maille d’1km) utilisés reviendront à chacun des groupes.\nL’atelier et le cours seront évalués conjointement à travers 3 rendus :\n\nun dossier technique (40%) : de l’extraction des données à la mise en œuvre de l’analyse. devra présenter la base de données (contenu synthétique, producteur, type de données, volume, fréquence de mise à jour), les modes de collecte (sites et formats), la qualité et les limites des données (niveau de représentativité, type de contrôle réalisés, biais liés à la collecte, comparabilité, etc.), les usages et croisements possibles, ainsi que les précautions à prendre concernant le terrain retenu.\n** un poster de présentation de la démarche et de ses résultats saillants (40%)** : les spécificités des logements quant à leur consommation énergétique et les contextes socio-économiques dans lesquels ils s’inscrivent seront au centre du poster. Formellement celui-ci sera doté des éléments suivants : Titre, problématique, présentation des méthodes utilisés, justification de la maille, du périmètre, des variables, présentation et discussion des principaux résultats, courte bibliographie. Le poster est nécessairement visuel : devront y figurer tableaux, graphiques, cartes et la place du texte y sera minimal. Des titres mettront en valeur les principales parties du poster.\nun oral (20%) au cours duquel seront restitués en 15 mn des éléments techniques phares et au cours duquel le poster sera commenté. Le travail se fera en groupes de 2 à 3 étudiants."
  },
  {
    "objectID": "index.html#références",
    "href": "index.html#références",
    "title": "Approches quantitatives pour l’action publique",
    "section": "Références",
    "text": "Références\n\nNicolas, J.-P., Wawrzyniak, V., Déprés, C., Gondran, N. et Truchet-Aznar, S. (2025). Rendre compte de la vulnérabilité énergétique logement-mobilité des ménages d’un territoire. Un système d’indicateurs pour outiller les politiques publiques locales. Revue d’Économie Régionale & Urbaine, Janvier(1), 53-80. https://doi.org/10.3917/reru.251.0053.\nAja P-R, Ouadi L.,et Péron M. (2024) Les effets des réformes du diagnostic de performance énergétique sur sa fiabilité. Focus n°105, juin 2024, Conseil d’analyse économique."
  },
  {
    "objectID": "choix_geom.html",
    "href": "choix_geom.html",
    "title": "Choix de la zone d’étude",
    "section": "",
    "text": "Code\nlibrary(knitr)\n\nlibrary(dplyr)\n\nlibrary(sf)\nlibrary(mapview)\nlibrary(mapsf)\nDans les cours précédents les étudiants ont été amenés à extraire des données de très grandes bases dont l’extension maximale couvrait les départements de la Seine Maritime et de l’Eure. Il s’agit désormais d’affiner le choix en se centrant sur l’objet d’étude principal qui est “Rouen”. Mais qu’est ce que l’on entends au juste par “Rouen” ?\nExaminons rapidement quelques uns des choix possibles en se bornant à les visualiser sous la forme de cartes interactives (avec le package mapview) ou de cartes stattiques avec le package (mapsf)."
  },
  {
    "objectID": "choix_geom.html#solution-1-laire-urbaine-de-rouen-aav1",
    "href": "choix_geom.html#solution-1-laire-urbaine-de-rouen-aav1",
    "title": "Choix de la zone d’étude",
    "section": "Solution 1 : L’aire urbaine de Rouen (AAV=1)",
    "text": "Solution 1 : L’aire urbaine de Rouen (AAV=1)\nL’aire urbaine de Rouen (au sens de l’INSEE) se présente géométriquement comme suit :\n\n\nCode\n# Chargement du fonds de carte\nmap &lt;- readRDS(\"base/mapcom.RDS\")\n\n# Affichage\nmapview(map)\n\n\n\n\n\n\nOn peut résumer rapidement ses caractéristiques\n\n\nCode\nsel&lt;-map\n# Calculs\nnbc &lt;- dim(sel)[1]\nsup &lt;- as.numeric(st_area(st_union(sel))/1000000)\npop &lt;- sum(sel$POPULATION, na.rm=T)\nloc &lt;- sum(sel$P21_LOG, na.rm=T)\ndpe &lt;- sum(sel$nDPE,na.rm=T)\n\ntab&lt;- c(nbc,sup, pop, loc, dpe)\nnames(tab)&lt;- c(\"nb. de communes\", \n               \"superfice (km2)\", \n               \"population (hab.)\",\n               \"nb. de logements\",\n               \"nb. de dpe\")\nkable(tab, digits=0, caption = \"Caractéristiques de l'aire urbaine de Rouen\")\n\n\n\nCaractéristiques de l’aire urbaine de Rouen\n\n\n\nx\n\n\n\n\nnb. de communes\n316\n\n\nsuperfice (km2)\n2792\n\n\npopulation (hab.)\n708816\n\n\nnb. de logements\n359282\n\n\nnb. de dpe\n173176"
  },
  {
    "objectID": "choix_geom.html#solution-2-lagglomération-de-rouen-uu1",
    "href": "choix_geom.html#solution-2-lagglomération-de-rouen-uu1",
    "title": "Choix de la zone d’étude",
    "section": "Solution 2 : l’agglomération de Rouen (UU=1)",
    "text": "Solution 2 : l’agglomération de Rouen (UU=1)\nL’agglomération de Rouen ou unité urbaine se présente géométriquement comme suit :\n\n\nCode\n## Sélection \nsel &lt;- map %&gt;% filter(UU==1)\n\n# Affichage\nmapview(sel)\n\n\n\n\n\n\nOn peut résumer rapidement ses caractéristiques\n\n\nCode\n# Calculs\nnbc &lt;- dim(sel)[1]\nsup &lt;- as.numeric(st_area(st_union(sel))/1000000)\npop &lt;- sum(sel$POPULATION, na.rm=T)\nloc &lt;- sum(sel$P21_LOG, na.rm=T)\ndpe &lt;- sum(sel$nDPE,na.rm=T)\n\ntab&lt;- c(nbc,sup, pop, loc, dpe)\nnames(tab)&lt;- c(\"nb. de communes\", \n               \"superfice (km2)\", \n               \"population (hab.)\",\n               \"nb. de logements\",\n               \"nb. de dpe\")\nkable(tab, digits=0, caption = \"Caractéristiques de l'agglomération de Rouen\")\n\n\n\nCaractéristiques de l’agglomération de Rouen\n\n\n\nx\n\n\n\n\nnb. de communes\n50\n\n\nsuperfice (km2)\n462\n\n\npopulation (hab.)\n475035\n\n\nnb. de logements\n254993\n\n\nnb. de dpe\n146038"
  },
  {
    "objectID": "choix_geom.html#solution-3-la-métropole-de-rouen-metro1",
    "href": "choix_geom.html#solution-3-la-métropole-de-rouen-metro1",
    "title": "Choix de la zone d’étude",
    "section": "Solution 3 : la métropole de Rouen (Metro=1)",
    "text": "Solution 3 : la métropole de Rouen (Metro=1)\nL’agglomération de Rouen ou unité urbaine se présente géométriquement comme suit :\n\n\nCode\n## Sélection \nsel &lt;- map %&gt;% filter(Metro==1)\n\n# Affichage\nmapview(sel)\n\n\n\n\n\n\nOn peut résumer rapidement ses caractéristiques\n\n\nCode\n# Calculs\nnbc &lt;- dim(sel)[1]\nsup &lt;- as.numeric(st_area(st_union(sel))/1000000)\npop &lt;- sum(sel$POPULATION, na.rm=T)\nloc &lt;- sum(sel$P21_LOG, na.rm=T)\ndpe &lt;- sum(sel$nDPE,na.rm=T)\n\ntab&lt;- c(nbc,sup, pop, loc, dpe)\nnames(tab)&lt;- c(\"nb. de communes\", \n               \"superfice (km2)\", \n               \"population (hab.)\",\n               \"nb. de logements\",\n               \"nb. de dpe\")\nkable(tab, digits=0, caption = \"Caractéristiques de l'agglomération de Rouen\")\n\n\n\nCaractéristiques de l’agglomération de Rouen\n\n\n\nx\n\n\n\n\nnb. de communes\n71\n\n\nsuperfice (km2)\n664\n\n\npopulation (hab.)\n497225\n\n\nnb. de logements\n265005\n\n\nnb. de dpe\n148519"
  },
  {
    "objectID": "choix_geom.html#solution-4-la-commune-de-rouen-insee_com-76540",
    "href": "choix_geom.html#solution-4-la-commune-de-rouen-insee_com-76540",
    "title": "Choix de la zone d’étude",
    "section": "Solution 4 : la commune de Rouen (INSEE_COM = 76540)",
    "text": "Solution 4 : la commune de Rouen (INSEE_COM = 76540)\nLa commune de Rouen se présente géométriquement comme suit :\n\n\nCode\n## Sélection \nsel &lt;- map %&gt;% filter(INSEE_COM == \"76540\")\n\n# Affichage\nmapview(sel)\n\n\n\n\n\n\nOn peut résumer rapidement ses caractéristiques\n\n\nCode\n# Calculs\nnbc &lt;- dim(sel)[1]\nsup &lt;- as.numeric(st_area(st_union(sel))/1000000)\npop &lt;- sum(sel$POPULATION, na.rm=T)\nloc &lt;- sum(sel$P21_LOG, na.rm=T)\ndpe &lt;- sum(sel$nDPE,na.rm=T)\n\ntab&lt;- c(nbc,sup, pop, loc, dpe)\nnames(tab)&lt;- c(\"nb. de communes\", \n               \"superfice (km2)\", \n               \"population (hab.)\",\n               \"nb. de logements\",\n               \"nb. de dpe\")\nkable(tab, digits=0, caption = \"Caractéristiques de l'agglomération de Rouen\")\n\n\n\nCaractéristiques de l’agglomération de Rouen\n\n\n\nx\n\n\n\n\nnb. de communes\n1\n\n\nsuperfice (km2)\n21\n\n\npopulation (hab.)\n114083\n\n\nnb. de logements\n75372\n\n\nnb. de dpe\n53274\n\n\n\n\n\nSi l’on retient ce choix, on pourra enrichir l’analyse par une étude des subdivisions interne de la commune à trois niveaux :\n\nen 42 zone IRIS\nen 10 quartiers regroupant plusieurs d’IRIS\nen 2 rives de la Seine\n\n\n\nCode\niris&lt;-st_read(\"base/iris.geojson\") %&gt;% filter(com_code==76540) %&gt;% \n  mutate(iris_code = as.character(iris_code),\n         iris_name = as.character(iris_name),\n         quart_code = as.character(iris_grd_quart_code),\n         quart_name = as.character(iris_grd_quart_name)) %&gt;%\n  select(iris_code, iris_name, quart_code, quart_name, geometry) %&gt;%\n  st_as_sf()\n\n\nReading layer `iris' from data source \n  `/Users/claudegrasland1/worldregio/dpe2025/base/iris.geojson' \n  using driver `GeoJSON'\nSimple feature collection with 488 features and 31 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 0.7279768 ymin: 49.17852 xmax: 1.653796 ymax: 49.75766\nGeodetic CRS:  WGS 84\n\n\nCode\nmapview(iris,zcol=\"quart_name\", label = \"iris_name\" )"
  },
  {
    "objectID": "choix_geom.html#solution-5-commune-de-rouen-et-communes-voisines",
    "href": "choix_geom.html#solution-5-commune-de-rouen-et-communes-voisines",
    "title": "Choix de la zone d’étude",
    "section": "Solution 5 : Commune de Rouen et communes voisines",
    "text": "Solution 5 : Commune de Rouen et communes voisines\nOn peut aussi décider de sélectionner la commune de Rouen et celles qui lui sont contiguës c’est-à-dire qui partagent avec elle une frontière commune.\n\n\nCode\n# Extraction de Rouen\nrouen &lt;- map %&gt;% filter(INSEE_COM ==\"76540\")\n\n# Interesection\nvois&lt;-st_intersection(map,rouen,sparse = F)\n\n# Extraction de Rouen et des communes voisines\nsel &lt;- map %&gt;% filter(INSEE_COM %in% vois$INSEE_COM)\n\n# Affichage\nmapview(sel,label=\"NOM\")\n\n\n\n\n\n\nOn peut résumer rapidement ses caractéristiques\n\n\nCode\n# Calculs\nnbc &lt;- dim(sel)[1]\nsup &lt;- as.numeric(st_area(st_union(sel))/1000000)\npop &lt;- sum(sel$POPULATION, na.rm=T)\nloc &lt;- sum(sel$P21_LOG, na.rm=T)\ndpe &lt;- sum(sel$nDPE,na.rm=T)\n\ntab&lt;- c(nbc,sup, pop, loc, dpe)\nnames(tab)&lt;- c(\"nb. de communes\", \n               \"superfice (km2)\", \n               \"population (hab.)\",\n               \"nb. de logements\",\n               \"nb. de dpe\")\nkable(tab, digits=0, caption = \"Caractéristiques de la zone constituée de la commune de Rouen et de ses voisines\")\n\n\n\nCaractéristiques de la zone constituée de la commune de Rouen et de ses voisines\n\n\n\nx\n\n\n\n\nnb. de communes\n13\n\n\nsuperfice (km2)\n101\n\n\npopulation (hab.)\n279549\n\n\nnb. de logements\n161558\n\n\nnb. de dpe\n99601\n\n\n\n\n\n\nVariante : On peut retoucher éventuellement la liste à la main pour ajouter une commune proche et non contigüe comme le Mesnil-Esnard. Ou bien utiliser un buffer pour inclure les communes situées à moins de x kilomètres"
  },
  {
    "objectID": "choix_geom.html#solution-6-zone-géométrique-centrée-sur-rouen",
    "href": "choix_geom.html#solution-6-zone-géométrique-centrée-sur-rouen",
    "title": "Choix de la zone d’étude",
    "section": "Solution 6 : Zone géométrique centrée sur Rouen",
    "text": "Solution 6 : Zone géométrique centrée sur Rouen\nOn peut enfin décider de construire une zone d’étude définie par des critères spatiaux et non pas territoriaux. C’est-à-dire une forme géométrique dont le tracé est indifférent aux limites adminisratives mais se fonde sur des caractéristiques de distance par rapport à des points caractéristiques.\nSupposons à titre d’exemple qu’on veuille définir un carré de 10 kilomètres sur 10 centré approximatvement sur le centre historique de la ville de Rouen. On choisit pour cela le centre de l’IRIS 7654000104 qui correspond à la place du vieux marché.\nComme nous allons mesurer la distance de façon euclidienne, on projette au prélable le fonds de carte en EPSG 2154.\n\n\nCode\nctr&lt;- iris %&gt;% filter(iris_code==765400104) %&gt;% st_transform(2154)\ncoo&lt;- st_coordinates(st_centroid(ctr))\nXctr&lt;-coo[1]\nYctr&lt;-coo[2]\nkable(coo)\n\n\n\n\n\nX\nY\n\n\n\n\n561156.5\n6928511\n\n\n\n\n\nNous déterminons alors les coordonnées des points d’un carré de côté 10 km dont le centre géométrique sera le centre de Rouen\n\n\nCode\nxmin&lt;-Xctr-5000\nymin&lt;-Yctr-5000\nxmax&lt;-Xctr+5000\nymax&lt;-Yctr+5000\nmybox &lt;-c(xmin,ymin,xmax,ymax)\nnames(mybox)&lt;-c(\"xmin\",\"ymin\",\"xmax\",\"ymax\")\nkable(mybox)\n\n\n\n\n\n\nx\n\n\n\n\nxmin\n556156.5\n\n\nymin\n6923510.5\n\n\nxmax\n566156.5\n\n\nymax\n6933510.5\n\n\n\n\n\nPuis nous transformons ces coordonnées en polygone que l’on visualise après être revenu à la projection en latitude et longitude\n\n\nCode\n# Transformation\npoly&lt;-st_as_sfc(st_bbox(mybox))\nzon&lt;-data.frame(name = \"zone\", geometry = poly) %&gt;% st_as_sf() \nst_crs(zon) &lt;- 2154\nzon &lt;- st_transform(zon, 4326)\n\n# Visualisation\nmapview(zon, zcol=\"name\")\n\n\n\n\n\n\nLa carré semble incliné lorsqu’on le visualise en projection EPSG 4326 mais il est en fait vertical dans la projection de référence française EPSG 2154. Lorsqu’on réalise des cartes avec map_sf on obtient une visualisation parfaitement verticale :\n\n\nCode\nzon&lt;-st_transform(zon, 2154)\ncom&lt;-st_transform(map, 2154)\niris&lt;-readRDS(\"base/mapiris.RDS\") %&gt;% st_transform(2154)\nctr&lt;-st_transform(st_centroid(ctr), 2154)\nmf_map(zon, type=\"base\", col=\"lightyellow\")\nmf_map(com, type=\"base\", col=NA, border=\"red\", add=T, lwd=2)\nmf_map(iris, type=\"base\", col=NA, border=\"red\", add=T, lwd=1)\nmf_map(ctr, type = \"base\",col=\"blue\", pch=20, add=T)\nmf_label(com, var=\"NOM\",cex=0.8,overlap = F,halo = T)\nmf_layout(\"Zone d'étude de 10km x 10km centrée sur la place du Vieux Marché de Rouen\", frame=T,scale = T, arrow=T, credits = \"Source : IGN\")\n\n\n\n\n\n\n\n\n\nComme on peut le voir, cette solution géométrique aboutit à découper les communes et également les IRIS dont les limites ne sont pas respectées. Est-ce un problème ?\nPas nécessairement dans la mesure où on peut combiner cette zone d’étude spatiale avec une autre source de donnée spatiale, la grille de population de l’INSEE par carreaux de 1km ou même de 200m.\n\n\nCode\ngrid200&lt;-st_read(\"base/grid_rouen.geojson\") %&gt;% st_transform(2154)\n\n\nReading layer `grid_rouen' from data source \n  `/Users/claudegrasland1/worldregio/dpe2025/base/grid_rouen.geojson' \n  using driver `GeoJSON'\nSimple feature collection with 2517 features and 19 fields\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: 0.9911299 ymin: 49.36695 xmax: 1.199355 ymax: 49.49277\nGeodetic CRS:  WGS 84\n\n\nCode\nmf_map(zon, type=\"base\", col=\"lightyellow\")\nmf_map(grid200, type=\"base\", col=NA, border=\"blue\",add=T)\nmf_map(com, type=\"base\", col=NA, border=\"red\", add=T, lwd=2)\nmf_map(iris, type=\"base\", col=NA, border=\"red\", add=T, lwd=1)\nmf_map(ctr, type = \"base\",col=\"blue\", pch=20, add=T)\nmf_label(com, var=\"NOM\",cex=0.8,overlap = F,halo = T)\nmf_layout(\"Zone d'étude de 10km x 10km centrée sur la place du Vieux Marché de Rouen\", frame=T,scale = T, arrow=T, credits = \"Source : IGN\")\n\n\n\n\n\n\n\n\n\nComme on peut le voir, la grille de 200m offre une couverture spatiale généralement plus fine que les IRIS et ne concerne que les zones ayant une population minimale. Elle permet donc un repérage beaucoup plus fin des caractéristiques sociales des zones où sont implantés les logements. Elle ne permet pas en revanche de saisir les effets de politiques communales ou de quartiers puisqu’un carreau peut rasselmbler des logements de deux communes différentes."
  },
  {
    "objectID": "choix_dpe.html",
    "href": "choix_dpe.html",
    "title": "Extraction de la base DPE",
    "section": "",
    "text": "Code\nlibrary(knitr)\n\nlibrary(dplyr)\n\nlibrary(sf)\nlibrary(mapview)\nlibrary(mapsf)\nOn suppose que le choix de la zone d’étude a été décidé parmi les différentes options possibles (Cf. chapitre précédent) et bien évidemment justifié. On va alors pouvoir passer à l’extraction des données de la base DPE ainsi qu’à la sélection des variables choisies pour l’étude ainsi qu’àleur éventuel recodage ou nettoyage.\nEn pratique, il est intéressant de disposer de deux sous-dossiers :\nCode\nlist.files(\"base\")\n\n\n[1] \"dpe_bbox.RDS\"       \"dpe.RDS\"            \"grid_rouen.geojson\"\n[4] \"iris.geojson\"       \"mapcom.RDS\"         \"mapgrid.RDS\"       \n[7] \"mapiris.RDS\"        \"mybbox.RDS\"         \"mygrid.RDS\"\nLe point important est de bien documenter le passage de la base brute à la base propre et de pouvoir tracer toutes les opérations effectuées afin de pouvoir ultérieurement modifier ou reproduire les opérations. C’est la raison pour laquelle il est recommandé d’utiliser à cette étape un programme plutôt qu’une succession de click.##"
  },
  {
    "objectID": "choix_dpe.html#choix-de-la-zone-détude",
    "href": "choix_dpe.html#choix-de-la-zone-détude",
    "title": "Extraction de la base DPE",
    "section": "1. Choix de la zone d’étude",
    "text": "1. Choix de la zone d’étude\nLa première étape consiste à construire un fichier donnant le périmètre de la zone d’étude sans s’occuper dans l’immédiat de ses subdivisions internes. On reprend donc l’une des solutions discutées au chapitre précédent et on créee un fichier géométrique zone que l’on enregistrera au format de son choix (.shp, .geojson, .gpkg, .RDS)\n\nExemple : on reprend la solution n°6 et on définit un carré de 10 kilomètres sur 10 centré sur la place du veiux marché à Rouen.\n\n\n\nCode\n# Chargement du fichier IRIS\niris &lt;- st_read(\"base/iris.geojson\")\n\n\nReading layer `iris' from data source \n  `/Users/claudegrasland1/worldregio/dpe2025/base/iris.geojson' \n  using driver `GeoJSON'\nSimple feature collection with 488 features and 31 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 0.7279768 ymin: 49.17852 xmax: 1.653796 ymax: 49.75766\nGeodetic CRS:  WGS 84\n\n\nCode\n# Extraction de l'IRIS central et projection\nctr&lt;- iris %&gt;% filter(iris_code==765400104) %&gt;% st_transform(2154)\n\n# Détermination des coordonnées projetées\ncoo&lt;- st_coordinates(st_centroid(ctr))\nXctr&lt;-coo[1]\nYctr&lt;-coo[2]\n\n# Calcul des points du polygone\nxmin&lt;-Xctr-5000\nymin&lt;-Yctr-5000\nxmax&lt;-Xctr+5000\nymax&lt;-Yctr+5000\nmybox &lt;-c(xmin,ymin,xmax,ymax)\nnames(mybox)&lt;-c(\"xmin\",\"ymin\",\"xmax\",\"ymax\")\n\n# Transformation en objet sf\npoly&lt;-st_as_sfc(st_bbox(mybox))\nzone&lt;-data.frame(name = \"zone\", geometry = poly) %&gt;% st_as_sf() \nst_crs(zone) &lt;- 2154\n\n# Projection en latitude longitude\n\n\n\n\nCode\nzone &lt;- st_transform(zone, 4326)\n\n# Visualisation de controle\n#mapview(zone)\n\n\nOn sauvegarde le fonds de carte au format .RDS\n\n\nCode\nsaveRDS(zone,\"data/zone.RDS\")"
  },
  {
    "objectID": "choix_dpe.html#choix-de-la-zone-buffer",
    "href": "choix_dpe.html#choix-de-la-zone-buffer",
    "title": "Extraction de la base DPE",
    "section": "2. Choix de la zone buffer",
    "text": "2. Choix de la zone buffer\nMaintenant que nous connaissaons notre zone d’étude, nous allons extraire de la base DPE les lignes correspondant à notre zone d’étude. Mais nous allons au préalable adjoindra éventuellement une zone buffer c’est-à-dire un espace d’une certaine largeur autour de la zone d’étude.\nPour créer la zone buffer, il est nécessaire de projeter la zone d’étude en EPSG=2154 puis de choisir une distance en mètres. A titre d’exemple on va ajouter une zone buffer de 1000 mètres autour de notre zone d’étude.\n\n\nCode\n# lecture du fichier zone\nzone &lt;- readRDS(\"data/zone.RDS\")\n\n# Transformation en EPSG 2154\nzone &lt;- st_transform(zone, 2154)\n\n# Créationdu buffer\nbuff &lt;-st_buffer(zone,dist = 1000)\n\n# Visualisation de contrôle\n#map1 &lt;- mapview(zone)\n#map2 &lt;- mapview(buff)\n#map1+map2\n\n\nOn sauvegarde le résultat au format .RDS\n\n\nCode\nsaveRDS(buff,\"data/buffer.RDS\")"
  },
  {
    "objectID": "choix_dpe.html#extraction-des-dpe",
    "href": "choix_dpe.html#extraction-des-dpe",
    "title": "Extraction de la base DPE",
    "section": "3. Extraction des DPE",
    "text": "3. Extraction des DPE\nNous allons maintenant extraire les données de la base DPE en retenant toutes celles qui sont situées dans la zone buffer et en ajoutant une variable permettant de préciser celles qui sont situées dans la zone d’étude et celles qui ont été ajoutées dans le buffer. A ce stade nous ne procédons à aucune sélection de variable et nous conservons la base dans son format initial sans modifications.\n\nChargement du tableau\nOn charge un tableau englobant la zone d’étude :\n\n\nCode\ndon &lt;- readRDS(\"base/dpe.RDS\") \n\n\n\n\nTransformation en fichier sf\nOn utilise les coordonnées contenues dans le fichier pour passer à un fichier géométrique de type sf. Ces coordonnées sont en EPSG 2154 ce qu’il faut préciser :\n\n\nCode\n# simplification du nom\ndon$x&lt;-don$coordonnee_cartographique_x_ban\ndon$y&lt;-don$coordonnee_cartographique_y_ban\n\n# transformation en fichier sf\nmap &lt;- st_as_sf(don, coords = c(\"x\",\"y\"))\n\n# ajout de la projection\nst_crs(map)&lt;- 2154\n\n\n\n\nExtraction des DPE\nIl suffit maintenant d’utiliser la fonction st_interesction() pour extraire les dpe situées dans la zone buffer. En veillant évidemment à ce que les deux fonds de carte aient la même projection.\n\n\nCode\n## Chargement de la zone d'étude et du buffer\nbuffer &lt;- readRDS(\"data/buffer.RDS\") %&gt;% st_transform(2154)\nzone &lt;- readRDS(\"data/zone.RDS\") %&gt;% st_transform(2154)\n\n# Intersections avec la zone d'étude et le buffer\ndpe_zone &lt;- st_intersection(map,zone)\ndpe &lt;- st_intersection(map,buffer)\n\n# ajout de la variable zone\ndpe$zone &lt;-as.factor(dpe$numero_dpe %in% dpe_zone$numero_dpe)\nlevels(dpe$zone) &lt;-c(\"Buffer\",\"Zone\")\n\n# comptage des DPE situées dans la zone d'étude et son buffer\ntable(dpe$zone)\n\n\n\nBuffer   Zone \n  7305 107924 \n\n\nOn ne sauvegarde pas tout de suite le fichier des dpe car on va lui ajouter des variables auxiliaires permettant d’effectuer des jointures vers d’autres bases de données auxiliaires."
  },
  {
    "objectID": "choix_dpe.html#ajout-de-données-auxiliaires",
    "href": "choix_dpe.html#ajout-de-données-auxiliaires",
    "title": "Extraction de la base DPE",
    "section": "4. Ajout de données auxiliaires",
    "text": "4. Ajout de données auxiliaires\nOn va ajouter pour terminer un certain nombre de données auxiliaires pouvant servir à enrichir les données dpe. Pour faciliter les liaisons entre les bases de données, on introduira dans la base dpe le code correspondant à ces données auxiliaires pour facliter les jointures ultérieures.\n\nCommunes\nOn ajoute un fonds de carte de l’ensemble des communes qui sont contenues dans la zone buffer ou interesectent celle-ci.\n\n\nCode\n# Chargement des fonds de carte\nmapcom&lt;-readRDS(\"base/mapcom.RDS\") %&gt;% st_transform(2154)\nbuffer &lt;- readRDS(\"data/buffer.RDS\") %&gt;% st_transform(2154)\n\n# Sélection des communes\nselcom&lt;-st_intersection(mapcom, buffer)$INSEE_COM\nmapcom &lt;-mapcom %&gt;% filter(INSEE_COM %in% selcom)\n\n# Vérification\n#m1 &lt;- mapview(buffer)\n#m2 &lt;- mapview(mapcom)\n#m1+m2\n\n\nIl n’est pas utile d’ajouter le code communal à la base dpe où il figure déjà. On enregistre directement le fichier\n\n\nCode\nsaveRDS(mapcom, \"data/mapcom.RDS\")\n\n\n\n\nIRIS\nOn effectue la même opération mais en prenant tous les iris des communes retenues dans la sélection précédente :\n\n\nCode\n## Chargement du fonds iris\nmapiris&lt;-st_read(\"base/iris.geojson\") %&gt;% filter(com_code %in% selcom) %&gt;% \n  mutate(iris_code = as.character(iris_code),\n         iris_name = as.character(iris_name),\n         quart_code = as.character(iris_grd_quart_code),\n         quart_name = as.character(iris_grd_quart_name)) %&gt;%\n  select(iris_code, iris_name, quart_code, quart_name, geometry) %&gt;%\n  st_transform(2154)%&gt;%\n  st_as_sf()\n\n\nReading layer `iris' from data source \n  `/Users/claudegrasland1/worldregio/dpe2025/base/iris.geojson' \n  using driver `GeoJSON'\nSimple feature collection with 488 features and 31 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 0.7279768 ymin: 49.17852 xmax: 1.653796 ymax: 49.75766\nGeodetic CRS:  WGS 84\n\n\nCode\n# Vérification\n#m1 &lt;- mapview(buffer)\n#m2 &lt;- mapview(mapiris)\n#m1+m2\n\n\nOn sauvegarde le fonds IRIS de la zone d’étude :\n\n\nCode\nsaveRDS(mapiris,\"data/mapiris.RDS\")\n\n\nOn ajoute à la base DPE un code permettant d’effectuer le lien avec le fonds de carte des IRIS :\n\n\nCode\n# Transforme le fonds de carte IRIS en tableau et ajoute un index\ntabiris&lt;-st_drop_geometry(mapiris)\ntabiris$num &lt;- 1:dim(tabiris)[1]\n\n#  Affecte chque dpe à un iris\nx&lt;-as.numeric(st_intersects(dpe,mapiris))\ndpe$num &lt;-x\ndpe &lt;- left_join(dpe,tabiris) %&gt;% select(-num)\n\n\n\n\nGrille 200 m\nOn sélectionne maintenant les données de grille de 200m contenues dans la zone buffer.\n\n\nCode\ngrid&lt;-st_read(\"base/grid_rouen.geojson\") %&gt;% st_transform(2154)\n\n\nReading layer `grid_rouen' from data source \n  `/Users/claudegrasland1/worldregio/dpe2025/base/grid_rouen.geojson' \n  using driver `GeoJSON'\nSimple feature collection with 2517 features and 19 fields\nGeometry type: POLYGON\nDimension:     XY\nBounding box:  xmin: 0.9911299 ymin: 49.36695 xmax: 1.199355 ymax: 49.49277\nGeodetic CRS:  WGS 84\n\n\nCode\nmapgrid&lt;-st_intersection(grid, buffer)\n\n# Vérification\n#m1 &lt;- mapview(buffer)\n#m2 &lt;- mapview(mapgrid)\n#m1+m2\n\n\nOn sauvegarde le fichier magrid.RDS\n\n\nCode\nsaveRDS(mapgrid,\"data/mapgrid.RDS\")\n\n\nOn va maintenant ajouter les coordonnées des points de grille au fichier des dpe pour faciliter les jointures ultérieures. On doit tenir compte ici du fait que certains logements ne tombent pas dans une grille pour des raisons de confidentialité mais celene concerne pas plus de 1% des DPE.\n\n\nCode\n# Transforme la grille en tableau et ajoute un index\ntabgrid&lt;-st_drop_geometry(mapgrid) %&gt;% select(idcar_200m)\ntabgrid$num &lt;- 1:dim(tabgrid)[1]\n\n#  Affecte chque dpe à un carreau\nx&lt;-as.numeric(st_intersects(dpe,mapgrid))\n\ndpe$num &lt;-x\ndpe &lt;- left_join(dpe,tabgrid) %&gt;% select(-num)\ntable(is.na(dpe$idcar_200m))\n\n\n\n FALSE   TRUE \n114178   1051"
  },
  {
    "objectID": "choix_dpe.html#selection-de-variables-du-fichier-dpe",
    "href": "choix_dpe.html#selection-de-variables-du-fichier-dpe",
    "title": "Extraction de la base DPE",
    "section": "5. Selection de variables du fichier DPE",
    "text": "5. Selection de variables du fichier DPE\nNous disposons désormais d’un fichier DPE complété par des variables supplémentaires relatives au code des communes, iris, quartier et grille de 200m ainsi que la localisation, permettant des analyses contextuelles, des agrégations, etc…\nNous allons y ajouter les variables de la base proprement dite qui nous semblent utile aux analyses que nous souhaitons mener. Pour réduire la taille des variables catégorielles, nous les convertissons en facteur car ce format est beaucoup plus économique.\n\n\nCode\nx&lt;-dpe %&gt;% mutate(      id = numero_dpe,\n                        zone = as.factor(zone),\n                        com_code = as.factor(code_insee_ban), \n                        com_name = as.factor(nom_commune_ban), \n                        iris_code = as.factor(iris_code), \n                        iris_name = as.factor(iris_name), \n                        quart_code = as.factor(quart_code), \n                        quart_name = as.factor(quart_name),\n                        idcar_200m = as.factor(idcar_200m),\n                        dat = as.integer(annee_construction),\n                        typ = as.factor(type_batiment),\n                        dpe = as.factor(etiquette_dpe),\n                        sup = as.numeric(surface_habitable_logement),\n                        con_tot = as.numeric(conso_5_usages_ep),\n                        con_m2 = as.numeric(conso_5_usages_par_m2_ep),\n                        ene = as.factor(type_energie_n1)\n                   ) %&gt;%\n             select(id, zone,com_code, com_name, iris_code, iris_name,quart_code, quart_name,\n                    idcar_200m,dat,typ,dpe,sup, con_tot, con_m2, ene)\nkable(head(x),caption = \"Extrait du fichier de données\")\n\n\n\nExtrait du fichier de données\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\n\nid\nzone\ncom_code\ncom_name\niris_code\niris_name\nquart_code\nquart_name\nidcar_200m\ndat\ntyp\ndpe\nsup\ncon_tot\ncon_m2\nene\ngeometry\n\n\n\n\n2276E0601625K\nZone\n76108\nBois-Guillaume\n761080104\nLa Bretèque\n7610801\nBois-Guillaume\nCRS3035RES200mN2967800E3677800\n1960\nappartement\nC\n65.0\n9607.2\n147.8\nGaz naturel\nPOINT (562548.4 6932080)\n\n\n2276E0604660D\nZone\n76540\nRouen\n765400104\nVieux Marché Sud Saint-Éloi\n7654001\nCentre Rive Droite Ouest\nCRS3035RES200mN2964800E3676200\n1900\nappartement\nD\n56.7\n13449.7\n237.2\nGaz naturel\nPOINT (561141 6928855)\n\n\n2276E0812571S\nZone\n76498\nLe Petit-Quevilly\n764980110\nLes Bruyères\n7649801\nLe Petit-Quevilly\nCRS3035RES200mN2961600E3674000\n1970\nappartement\nE\n54.5\n15687.2\n288.1\nÉlectricité\nPOINT (559409.1 6925510)\n\n\n2276E0037900R\nZone\n76540\nRouen\n765400601\nSaint-Hilaire\n7654006\nQuartiers Est\nCRS3035RES200mN2964200E3678800\n1948\nappartement\nF\n90.6\n29722.1\n328.0\nGaz naturel\nPOINT (563744.8 6928629)\n\n\n2276E0041369C\nZone\n76540\nRouen\n765400106\nBeauvoisine\n7654001\nCentre Rive Droite Ouest\nCRS3035RES200mN2964800E3677200\n1949\nmaison\nD\n70.0\n12936.9\n192.0\nÉlectricité\nPOINT (562180.7 6929056)\n\n\n2276E1163399C\nZone\n76474\nNotre-Dame-de-Bondeville\n764740104\nLes Coteaux-Les Longs Vallons\n7647401\nNotre-Dame-de-Bondeville\nCRS3035RES200mN2968600E3674600\nNA\nappartement\nF\n27.0\n9698.8\n359.0\nÉlectricité\nPOINT (559164.4 6932453)\n\n\n\n\n\nOn ajoute un fichier de métadonnées :\n\n\nCode\nvar &lt;- names(x)\nlabel &lt;- c(\"Identififiant DPE\",\n           \"Zone d'étude ou buffer\",\n           \"Code INSEE de la commune\",\n           \"Nom de la commune\",\n           \"Code INSEE de l'IRIS\",\n           \"Nom de l'IRIS\",\n           \"Code INSEE du quartier\",\n           \"Nom du quartier\",\n           \"Code INSEE du carreau de 200m\",\n           \"Ancienneté du bâtiment\",\n           \"Type de bâtiment\",\n           \"Classe DPE (A..G)\",\n           \"Surface habitable du logement\",\n           \"Consommation totale d'énergie primaire\",\n           \"Consommation totale d'énergie primaire par m2\",\n           \"Energie principale\",\n           \"Coordonnées géographiques\")\nmeta &lt;- data.frame(var, label)\nkable(meta, caption = \"Liste des variables sélectionnées ou ajoutées\")\n\n\n\nListe des variables sélectionnées ou ajoutées\n\n\nvar\nlabel\n\n\n\n\nid\nIdentififiant DPE\n\n\nzone\nZone d’étude ou buffer\n\n\ncom_code\nCode INSEE de la commune\n\n\ncom_name\nNom de la commune\n\n\niris_code\nCode INSEE de l’IRIS\n\n\niris_name\nNom de l’IRIS\n\n\nquart_code\nCode INSEE du quartier\n\n\nquart_name\nNom du quartier\n\n\nidcar_200m\nCode INSEE du carreau de 200m\n\n\ndat\nAncienneté du bâtiment\n\n\ntyp\nType de bâtiment\n\n\ndpe\nClasse DPE (A..G)\n\n\nsup\nSurface habitable du logement\n\n\ncon_tot\nConsommation totale d’énergie primaire\n\n\ncon_m2\nConsommation totale d’énergie primaire par m2\n\n\nene\nEnergie principale\n\n\ngeometry\nCoordonnées géographiques\n\n\n\n\n\nOn sauvegarde le tout dans le fichier dpe.RDS (qui ne fait que 3 Mo) et on y ajoute le fichier dpe_meta.RDS\n\n\nCode\nsaveRDS(x, \"data/dpe.RDS\")\nsaveRDS(meta, \"data/dpe_meta.RDS\")"
  }
]